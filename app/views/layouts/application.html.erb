<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Marketplace" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Marketplace">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body data-controller="sidebar">
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-brand">
          <%= link_to "–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å", root_path %>
        </div>
        
        <!-- –ü–æ—à—É–∫ –≤ navbar -->
        <div class="nav-search">
          <%= form_with url: search_path, method: :get, local: true, class: "nav-search-form" do |form| %>
            <div class="nav-search-input-group">
              <%= form.text_field :search, 
                  placeholder: "–Ø —à—É–∫–∞—é...", 
                  value: params[:search],
                  class: "nav-search-input" %>
              <%= form.submit "–ü–æ—à—É–∫", class: "nav-search-btn" %>
            </div>
          <% end %>
        </div>
        
        <div class="nav-links">
          <%= link_to "–ö–æ—à–∏–∫", cart_path, class: "nav-link" %>
          <% if current_user %>
            <button type="button" class="btn-cabinet nav-link" data-action="click->sidebar#open">
              –ö–∞–±—ñ–Ω–µ—Ç
            </button>
          <% else %>
            <%= link_to "–£–≤—ñ–π—Ç–∏", login_path, class: "nav-link" %>
            <%= link_to "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è", register_path, class: "nav-link nav-link-primary" %>
          <% end %>
        </div>
      </div>
    </nav>

    <% if notice %>
      <div class="flash flash-notice"><%= notice %></div>
    <% end %>
    
    <% if alert %>
      <div class="flash flash-alert"><%= alert %></div>
    <% end %>

    <main class="main-content">
      <%= yield %>
    </main>

    <% if current_user %>
      <!-- Sidebar -->
      <aside data-sidebar-target="sidebar" class="user-sidebar">
        <div class="sidebar-header-user">
          <h3 class="sidebar-user-email"><%= current_user.email %></h3>
          <button type="button" class="sidebar-close-btn" data-action="click->sidebar#close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">
            √ó
          </button>
        </div>
        
        <nav class="sidebar-nav-user">
          <% if current_user.seller? %>
            <%= link_to seller_root_path, class: "sidebar-nav-item" do %>
              <span class="sidebar-nav-icon">üè™</span>
              <span>–ö–∞–±—ñ–Ω–µ—Ç –ø—Ä–æ–¥–∞–≤—Ü—è</span>
            <% end %>
          <% else %>
            <button type="button" class="sidebar-nav-item" data-action="click->sidebar#openPopup">
              <span class="sidebar-nav-icon">üè™</span>
              <span>–ö–∞–±—ñ–Ω–µ—Ç –ø—Ä–æ–¥–∞–≤—Ü—è</span>
            </button>
          <% end %>
          
          <%= button_to logout_path, method: :delete, class: "sidebar-nav-item", form: { class: "sidebar-logout-form", data: { turbo: false } } do %>
            <span class="sidebar-nav-icon">üö™</span>
            <span>–í–∏—Ö—ñ–¥</span>
          <% end %>
        </nav>
        </aside>
        <div data-sidebar-target="overlay" class="sidebar-overlay" data-action="click->sidebar#close"></div>

        <!-- Pop-up –¥–ª—è —Å—Ç–∞—Ç–∏ –ø—Ä–æ–¥–∞–≤—Ü–µ–º -->
        <% unless current_user.seller? %>
          <div data-sidebar-target="popup" class="seller-popup" style="display: none;">
          <div class="seller-popup-content">
            <h3>–°—Ç–∞—Ç–∏ –ø—Ä–æ–¥–∞–≤—Ü–µ–º</h3>
            <p>–í–∏ —Ö–æ—á–µ—Ç–µ —Å—Ç–∞—Ç–∏ –ø—Ä–æ–¥–∞–≤—Ü–µ–º –Ω–∞ –Ω–∞—à–æ–º—É –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ñ?</p>
            <div class="seller-popup-buttons">
              <button type="button" class="btn-primary" data-action="click->sidebar#closePopup">–¢–∞–∫</button>
              <button type="button" class="btn-secondary" data-action="click->sidebar#closePopup">–ù—ñ</button>
            </div>
          </div>
        </div>
        <% end %>
    <% end %>
  </body>
</html>